# å®˜æ–¹æ‰‹å†Œ - https://manual.nssurge.com/
# ç†è§£åŸç† - https://manual.nssurge.com/book/understanding-surge/cn/
# æŠ€æœ¯ç¤¾åŒº - https://community.nssurge.com
# æ¨¡å—åˆé›† - https://book.surge.tel/surge-ios/modules

# é“¾æ¥ä¸‹è½½ - https://raw.githubusercontent.com/Di1123/1123/main/surge/surge.conf
# 2024å¹´6æœˆ15æ—¥20:17:03
[General]
# å¢å¼ºç‰ˆ Wi-Fi åŠ©ç†
wifi-assist = true

# æ··åˆç½‘ç»œ
all-hybrid = false

#æé«˜å¤„ç† UDP æµé‡ä¼˜å…ˆçº§
udp-priority = true

# ç½‘ç»œè®¿é—®å»¶è¿Ÿæµ‹é€ŸURL
internet-test-url = http://www.baidu.com

# ä»£ç†å»¶è¿Ÿæµ‹é€ŸURL
proxy-test-url = http://www.google.com/generate_204

# æµ‹è¯•è¶…æ—¶ï¼ˆç§’ï¼‰
test-timeout = 5

# GeoIPæ•°æ®åº“
geoip-maxmind-url = https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb

# GeoIPæ•°æ®åº“è‡ªåŠ¨æ›´æ–°
disable-geoip-db-auto-update = false

# IPv6æ”¯æŒ
ipv6 = false

# IPv6 VIF
ipv6-vif = disabled

# > å…è®¸Wi-Fiè®¿é—®
allow-wifi-access = false

# å…è®¸ä¸ªäººçƒ­ç‚¹è®¿é—®
allow-hotspot-access = true

# æ—¥å¿—çº§åˆ«
loglevel = notify

# ä» /etc/hosts è¯»å– DNS è®°å½•
read-etc-hosts = true

# å½“é‡åˆ° REJECT ç­–ç•¥æ—¶è¿”å›é”™è¯¯é¡µ
show-error-page-for-reject = true

# > DNS æœåŠ¡å™¨
dns-server = 223.5.5.5, 119.29.29.29
# encrypted-dns-server = https://223.5.5.5/dns-query

# DNS åŠ«æŒ
hijack-dns = 8.8.8.8:53, 8.8.4.4:53

# è·³è¿‡ä»£ç†
skip-proxy = 192.168.0.0/24, 10.0.0.0/8, 172.16.0.0/12, 127.0.0.1, localhost, *.local, seed-sequoia.siri.apple.com, sequoia.siri.apple.com, sequoia.apple.com, iosapps.itunes.apple.com

# æ’é™¤ç®€å•ä¸»æœºå
exclude-simple-hostnames = true

# çœŸå®IPåœ°å€
always-real-ip = *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com*.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com, *.battlenet.com.cn, *.battlenet.com, *.blzstatic.cn, *.battle.net

[Replica]
# > éšè— Apple è¯·æ±‚
hide-apple-request = false
# > éšè—å´©æºƒè¿½è¸ªå™¨è¯·æ±‚
hide-crash-reporter-request = true
# > éšè— UDP ä¼šè¯
hide-udp = false
# > å…³é”®è¯è¿‡æ»¤å™¨
keyword-filter-type = false

[Ponte]
client-proxy-name = PROXY

[Panel]
YJ = script-name=YJ,update-interval=43200

{{{ST Panel}}} = script-name={{{ST Panel}}},update-interval={{{update-interval}}}

[Proxy Group]
PROXY = select, HK, TW, JP, SG, US
Final = select, HK, TW, JP, SG, US, DIRECT
Streaming = select, HK, TW, JP, SG, US
HK = smart, policy-path=è®¢é˜…, interval=600, tolerance=50, update-interval=86400, policy-regex-filter=(ğŸ‡­ğŸ‡°)|(æ¸¯)|(Hong)|(HK), hidden=false
TW = smart, policy-path=è®¢é˜…, interval=600, tolerance=50, update-interval=86400, policy-regex-filter=(ğŸ‡¨ğŸ‡³)|(å°)|(Tai)|(TW), hidden=false
JP = smart, policy-path=è®¢é˜…, interval=600, tolerance=50, update-interval=86400, policy-regex-filter=(ğŸ‡¯ğŸ‡µ)|(æ—¥)|(Japan)|(JP), hidden=false
SG = smart, policy-path=è®¢é˜…, interval=600, tolerance=50, update-interval=86400, policy-regex-filter=(ğŸ‡¸ğŸ‡¬)|(æ–°)|(Singapore)|(SG), hidden=false
US = smart, policy-path=è®¢é˜…, interval=600, tolerance=50, update-interval=86400, policy-regex-filter=(ğŸ‡ºğŸ‡¸)|(ç¾)|(States)|(US), hidden=false

[Rule]
# é˜²æ­¢åº”ç”¨å¾ªç¯è¯·æ±‚
IP-CIDR,0.0.0.0/32,REJECT,no-resolve

# Custom
DEST-PORT,123,DIRECT

# å±è”½ HTTP3/QUIC åè®®
# é˜»æ­¢æ‰€æœ‰ UDP æµé‡è¿›å…¥443ç«¯å£ï¼Œä½¿ HTTP3 è¯·æ±‚å›è½åˆ° TCP æµé‡ã€‚
AND,((PROTOCOL,UDP), (DEST-PORT,443)),REJECT-NO-DROP

# Safari è®¿é—®é˜²è·³è½¬ App
DOMAIN,app-site-association.cdn-apple.com,REJECT

# Streaming!CN
RULE-SET,https://raw.githubusercontent.com/ConnersHua/RuleGo/master/Surge/Ruleset/Extra/Streaming/!CN.list,Streaming,extended-matching

# Twitter
RULE-SET,https://raw.githubusercontent.com/ConnersHua/RuleGo/master/Surge/Ruleset/Extra/X.list,PROXY,extended-matching

# GitHub
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/GitHub/GitHub.list,PROXY,extended-matching

# Proxy
RULE-SET,https://raw.githubusercontent.com/ConnersHua/RuleGo/master/Surge/Ruleset/Proxy.list,PROXY,extended-matching

# Direct
RULE-SET,https://raw.githubusercontent.com/ConnersHua/RuleGo/master/Surge/Ruleset/Direct.list,DIRECT,extended-matching

# è…¾è®¯ WeChat ASN
IP-ASN,132203,DIRECT
IP-ASN,56040,DIRECT
IP-ASN,45090,DIRECT
# è…¾è®¯ WeChat
RULE-SET,https://raw.githubusercontent.com/NobyDa/Script/master/Surge/WeChat.list,DIRECT

# Local Area Network
RULE-SET,LAN,DIRECT

# GeoIP China
GEOIP,CN,DIRECT

# Proxy+
RULE-SET,https://raw.githubusercontent.com/ConnersHua/RuleGo/master/Surge/Ruleset/Proxy+.list,PROXY

# Final å…œåº•
FINAL,Final,dns-failed

# ç™¾åº¦è´´å§å»å¹¿å‘Š
RULE-SET,https://raw.githubusercontent.com/app2smile/rules/master/rule/tieba-ad.list,REJECT-DROP

[URL Rewrite]
# Safari å…¨èƒ½æœç´¢ã€éœ€è¦æŠŠ Safari çš„æœç´¢å¼•æ“è®¾ç½®ä¸º: DuckDuckGo
^https:\/\/duckduckgo.com\/\?q=gm\+([^&]+).+ https://www.google.com/search?&tbm=isch&q=$1 302
^https:\/\/duckduckgo.com\/\?q=gh\+([^&]+).+ https://github.com/search?q=$1 302
^https:\/\/duckduckgo.com\/\?q=wx\+([^&]+).+ https://weixin.sogou.com/weixinwap?query=$1 302
^https:\/\/duckduckgo.com\/\?q=jd\+([^&]+).+ https://so.m.jd.com/ware/search.action?keyword=$1 302
^https:\/\/duckduckgo.com\/\?q=ytb\+([^&]+).+ https://www.youtube.com/results?search_query=$1 302
^https:\/\/duckduckgo.com\/\?q=ph\+([^&]+).+ https://cn.pornhub.com/video/search?search=$1 302
^https:\/\/duckduckgo.com\/\?q=db\+([^&]+).+ https://m.douban.com/search/?query=$1 302
^https:\/\/duckduckgo.com\/\?q=ddg\+([^&]+).+ https://duckduckgo.com/?ia=about&q=$1 302
^https:\/\/duckduckgo.com\/\?q=([^&]+).+ https://www.google.com/search?q=$1 302
^https?:\/\/(www.)?(g|google)\.cn https://www.google.com 302
^https?:\/\/(ditu|maps).google\.cn https://maps.google.com 302

^https?:\/\/app\.bilibili\.com\/x\/resource\/ip - reject
^https?:\/\/app\.bilibili\.com\/bilibili\.app\.interface\.v1\.Search\/Default - reject
^https?:\/\/api\.vc\.bilibili\.com\/search_svr\/v\d\/Search\/recommend_words - reject

[Map Local]
^https?:\/\/app\.bilibili\.com\/x\/resource\/top\/activity data="https://raw.githubusercontent.com/deezertidal/Surge_Module/master/files/reject-dict.json"
^https://app.bilibili.com/x/v2/splash/show data="https://raw.githubusercontent.com/deezertidal/Surge_Module/master/files/reject-dict.json"
^https://app.bilibili.com/x/v2/search/defaultwords data="https://raw.githubusercontent.com/deezertidal/Surge_Module/master/files/reject-dict.json"
^https?:\/\/api\.bilibili\.com\/x\/vip\/ads\/material\/report data="https://raw.githubusercontent.com/deezertidal/Surge_Module/master/files/reject-dict.json"
^https://api.bilibili.com/pgc/season/player/cards data="https://raw.githubusercontent.com/deezertidal/Surge_Module/master/files/reject-dict.json"
^https?:\/\/api\.vc\.bilibili\.com\/topic_svr\/v1\/topic_svr data="https://raw.githubusercontent.com/deezertidal/Surge_Module/master/files/reject-dict.json"
^https?:\/\/api\.bilibili\.com\/pgc\/season\/app\/related\/recommend\? data="https://raw.githubusercontent.com/deezertidal/Surge_Module/master/files/reject-dict.json"
^https?:\/\/manga\.bilibili\.com\/twirp\/comic\.v\d\.Comic\/(Flash|ListFlash) data="https://raw.githubusercontent.com/deezertidal/Surge_Module/master/files/reject-dict.json"

[Script]
YJ = type=generic,timeout=5,script-path=https://raw.githubusercontent.com/getsomecat/GetSomeCats/Surge/script/youjia.js,argument=hebei/langfang

è±†ç“£å½±è§† = type=http-response,pattern=^https://m.douban.com/movie/subject/.+,requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/githubdulong/Script/master/Douban.js

äº¬ä¸œæ¯”ä»· = type=http-response,requires-body=1,pattern=^https?:\/\/api\.m\.jd\.com\/client\.action\?functionId=(wareBusiness|serverConfig|basicConfig),script-path=https://raw.githubusercontent.com/deezertidal/private/main/jdprice.js

è´´å§å‡€åŒ– = type=http-response,pattern=^http(s:\/\/tiebac|:\/\/c\.tieba)\.baidu\.com\/(tiebaads\/commonbatch|c\/s\/sync),requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/tieba-json.js,script-update-interval=0
è´´å§Proto = type=http-response,pattern=^http(s:\/\/tiebac|:\/\/c\.tieba)\.baidu\.com\/c\/f\/(frs\/(page|threadlist|generalTabList)|pb\/page|excellent\/personalized),requires-body=1,binary-body-mode=1,max-size=0,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/tieba-proto.js,script-update-interval=0

è§£é™¤å¾®ä¿¡é“¾æ¥é™åˆ¶ = type=http-response,pattern=^https\:\/\/(weixin110\.qq|security.wechat)\.com\/cgi-bin\/mmspamsupport-bin\/newredirectconfirmcgi\?,requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/zZPiglet/Task/master/asset/UnblockURLinWeChat.js

troubleshoot = type=http-request, pattern=^https?:\/\/(trouble\.shoot|surge\.tool), timeout=300,script-update-interval={{{script-update}}}, script-path=https://raw.githubusercontent.com/Keywos/rule/main/script/st/js/index.js
{{{ST Panel}}} = type=generic,timeout=30,argument=list={{{List}}}&type={{{Type}}}&LogTF={{{Log}}}&icolor={{{color}}}&title={{{title}}}&icon={{{icon}}}&push={{{Push}}},script-update-interval={{{script-update}}},script-path=https://raw.githubusercontent.com/Keywos/rule/main/script/st/js/index.js

biliad=type=http-response,pattern=^https?:\/\/i.\.hdslb\.com\/bfs\/subtitle\/.+\.json$,requires-body=1,script-path=https://github.com/deezertidal/private/raw/master/js-backup/Rewrite/Function/Bilibili_CC.conf
biliad1=type=http-response,pattern=^https?:\/\/api\.(bilibili|biliapi)\.(com|net)\/pgc\/page\/cinema\/tab\?,requires-body=1,script-path=https://raw.githubusercontent.com/deezertidal/private/master/js-backup/Script/bilibili_json.js
biliad2=type=http-response,pattern=^https:\/\/app\.bilibili\.com\/x\/v2\/splash\/list,requires-body=1,script-path=https://raw.githubusercontent.com/deezertidal/private/master/js-backup/Script/bilibili_json.js
biliad3=type=http-response,pattern=^https?:\/\/app\.bilibili\.com\/x\/resource\/show\/skin\?,requires-body=1,script-path=https://raw.githubusercontent.com/deezertidal/private/master/js-backup/Script/bilibili_json.js
biliad4=type=http-response,pattern=^https?:\/\/app\.bilibili\.com\/x\/v2\/account\/myinfo\?,requires-body=1,script-path=https://raw.githubusercontent.com/deezertidal/private/master/js-backup/Script/bilibili_json.js
biliad5=type=http-response,pattern=^https://app.bilibili.com/x/v2/search/square,requires-body=1,script-path=https://raw.githubusercontent.com/deezertidal/private/master/js-backup/Script/bilibili_json.js
biliad6=type=http-response,pattern=^https?:\/\/app\.bilibili\.com\/x\/v2\/feed\/index,requires-body=1,script-path=https://raw.githubusercontent.com/deezertidal/private/master/js-backup/Script/bilibili_json.js
biliad7=type=http-response,pattern=^https?:\/\/api\.(bilibili|biliapi)\.(com|net)\/pgc\/page\/bangumi,requires-body=1,script-path=https://raw.githubusercontent.com/deezertidal/private/master/js-backup/Script/bilibili_json.js
biliad8=type=http-response,pattern=^https?:\/\/api\.live\.bilibili\.com\/xlive\/app-room\/v1\/index\/getInfoByRoom,requires-body=1,script-path=https://raw.githubusercontent.com/deezertidal/private/master/js-backup/Script/bilibili_json.js
biliad9=type=http-response,pattern=^https?:\/\/api\.vc\.bilibili\.com\/dynamic_svr\/v1\/dynamic_svr\/dynamic_(history|new)\?,requires-body=1,script-path=https://raw.githubusercontent.com/deezertidal/private/master/js-backup/Script/bilibili_json.js
biliad10=type=http-response,pattern=^https?:\/\/app\.bilibili\.com\/x\/resource\/show\/tab,requires-body=1,script-path=https://raw.githubusercontent.com/deezertidal/private/master/js-backup/Script/bilibili_json.js
biliad11=type=http-response,pattern=^https?:\/\/app\.bilibili\.com\/x\/v2\/account\/mine,requires-body=1,script-path=https://raw.githubusercontent.com/deezertidal/private/master/js-backup/Script/bilibili_json.js
biliad12=type=http-response,pattern=^https:\/\/app\.bilibili\.com\/bilibili\.app\.(view\.v1\.View\/View|dynamic\.v2\.Dynamic\/DynAll)$,requires-body=1,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/bilibili-proto.js
biliad13=type=http-response,pattern=^https://app\.bilibili\.com/bilibili\.app\.dynamic\.v2\.Dynamic/DynAll$,requires-body=1,script-path=https://raw.githubusercontent.com/yjqiang/surge_scripts/main/scripts/bilibili/bilibili_dynamic.js

[MITM]
# è·³è¿‡æœåŠ¡ç«¯è¯ä¹¦éªŒè¯
skip-server-cert-verify = true

# MITM over HTTP/2
h2 = true

# ä¸»æœºå
hostname = api.m.jd.com, m.douban.com, duckduckgo.com, www.google.cn, www.g.cn, tiebac.baidu.com, security.wechat.com, weixin110.qq.com, trouble.shoot, *.trouble.shoot, surge.tool, app.bilibili.com,api.live.bilibili.com,api.vc.bilibili.com, api.bilibili.com, manga.bilibili.com, grpc.biliapi.net,api.biliapi.net, -broadcast.chat.bilibili.com, -*cdn*.biliapi.net, -*tracker*.biliapi.net