# å®˜æ–¹æ‰‹å†Œ - https://manual.nssurge.com/
# ç†è§£åŸç† - https://manual.nssurge.com/book/understanding-surge/cn/
# æŠ€æœ¯ç¤¾åŒº - https://community.nssurge.com
# æ¨¡å—åˆé›† - https://book.surge.tel/surge-ios/modules
#           https://whatshub.top/module/caiyun.module

# é“¾æ¥ä¸‹è½½ - https://raw.githubusercontent.com/Di1123/1123/main/surge/surge.conf

# 2024å¹´3æœˆ6æ—¥21:33:22

[General]
# > Wi-Fi è®¿é—®
allow-wifi-access = false

# > çƒ­ç‚¹åˆ†äº«ä»£ç†
allow-hotspot-access = true

# æ··åˆç½‘ç»œ
all-hybrid = false

# > å…è®¸WiFiè®¿é—®
allow-wifi-access = false

# > æé«˜å¤„ç† UDP æµé‡ä¼˜å…ˆçº§            
udp-priority = true

# > IPv6 æ”¯æŒ
ipv6 = false

# > IPv6 VIF
ipv6-vif = disabled

# > ç½‘ç»œè®¿é—®å»¶è¿Ÿæµ‹é€ŸURL
internet-test-url = http://www.baidu.com

# > ä»£ç†å»¶è¿Ÿæµ‹é€ŸURL
proxy-test-url = http://www.google.com/generate_204

# > æµ‹è¯•è¶…æ—¶ï¼ˆç§’ï¼‰
test-timeout = 2

# > GeoIPæ•°æ®åº“
geoip-maxmind-url = https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb

# > GeoIP æ•°æ®åº“è‡ªåŠ¨æ›´æ–°
disable-geoip-db-auto-update = false

# > æ—¥å¿—çº§åˆ«
loglevel = notify

# > å½“é‡åˆ°REJECTç­–ç•¥æ—¶è¿”å›é”™è¯¯é¡µ
show-error-page-for-reject = true

# > è·³è¿‡ä»£ç†
skip-proxy = 127.0.0.1, 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, 100.64.0.0/10, localhost, *.local, iosapps.itunes.apple.com, seed-sequoia.siri.apple.com, sequoia.apple.com, www.baidu.com, yunbusiness.ccb.com, wxh.wo.cn, www.abchina.com.cn, csms.cfldcn.com, sublink.cute-cloud.top

# > æ’é™¤ç®€å•ä¸»æœºå
exclude-simple-hostnames = true

# ---DNS æœåŠ¡å™¨---
dns-server = 119.29.29.29, 223.5.5.5, system

# > ä»/etc/hostsè¯»å–DNSè®°å½•
read-etc-hosts = true

# > å…³é—­ DOH çš„æœåŠ¡ç«¯è¯ä¹¦éªŒè¯
doh-skip-cert-verification=true

# > è·¯ç”±é˜²ç«å¢™
# åŒ…å«æ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚
include-all-networks = false

# > åŒ…å«æœ¬åœ°ç½‘ç»œè¯·æ±‚
include-local-networks = false

# > ä»£ç†è¯·æ±‚æœ¬åœ° DNS æ˜ å°„
use-local-host-item-for-proxy = false

# > Boxjs
force-http-engine-hosts = boxjs.com, boxjs.net, *.boxjs.com, *.boxjs.net

[Replica]
# > éšè— Apple è¯·æ±‚
hide-apple-request = false
# > éšè—å´©æºƒè¿½è¸ªå™¨è¯·æ±‚
hide-crash-reporter-request = true
# > éšè— UDP ä¼šè¯
hide-udp = false
# > å…³é”®è¯è¿‡æ»¤å™¨
keyword-filter-type = false

[Panel]
èŠ‚å‡æé†’ = script-name=èŠ‚å‡æé†’,update-interval=3600

YJ = script-name=YJ,update-interval=43200

ç½‘ç»œä¿¡æ¯ = script-name=ç½‘ç»œä¿¡æ¯,title=ç½‘ç»œä¿¡æ¯,content=è¯·åˆ·æ–°,style=info,update-interval=60

stream-all = script-name=stream-all, title="æµåª’ä½“è§£é”æ£€æµ‹", content="è¯·åˆ·æ–°é¢æ¿", update-interval=3600

[Proxy]
Direct = direct
Reject = reject

[Proxy Group]
Proxy = select, HK, TW, JP, SG, US

Final = select, HK, TW, JP, SG, US, Direct

Apple = select, Direct, HK, TW, JP, SG, US

Netflix = select, HK, TW, JP, SG, US

HK = fallback, policy-path=è®¢é˜…, interval=600, tolerance=50, update-interval=86400, policy-regex-filter=(ğŸ‡­ğŸ‡°)|(æ¸¯)|(Hong)|(HK), hidden=false

TW = fallback, policy-path=è®¢é˜…, interval=600, tolerance=50, update-interval=86400, policy-regex-filter=(ğŸ‡¨ğŸ‡³)|(å°)|(Tai)|(TW), hidden=false

JP = fallback, policy-path=è®¢é˜…, interval=600, tolerance=50, update-interval=86400, policy-regex-filter=(ğŸ‡¯ğŸ‡µ)|(æ—¥)|(Japan)|(JP), hidden=false

SG = fallback, policy-path=è®¢é˜…, interval=600, tolerance=50, update-interval=86400, policy-regex-filter=(ğŸ‡¸ğŸ‡¬)|(æ–°)|(Singapore)|(SG), hidden=false

US = fallback, policy-path=è®¢é˜…, interval=600, tolerance=50, update-interval=86400, policy-regex-filter=(ğŸ‡ºğŸ‡¸)|(ç¾)|(States)|(US), hidden=false

[Rule]
# é˜²æ­¢åº”ç”¨å¾ªç¯è¯·æ±‚
IP-CIDR,0.0.0.0/32,Reject,no-resolve

# å±è”½ HTTP3/QUIC åè®®
# é˜»æ­¢æ‰€æœ‰ UDP æµé‡è¿›å…¥443ç«¯å£ï¼Œä½¿ HTTP3 è¯·æ±‚å›è½åˆ° TCP æµé‡ã€‚
AND,((PROTOCOL,UDP),(DEST-PORT,443)),REJECT-NO-DROP

# å±è”½ YouTube çš„ UDP
AND,((PROTOCOL,UDP),(DOMAIN-SUFFIX,googlevideo.com)),REJECT-NO-DROP

# Safari è®¿é—®é˜²è·³è½¬ App
DOMAIN,app-site-association.cdn-apple.com,Reject

# ç»•è¿‡ App ä¼ä¸šè¯ä¹¦è¿‡æœŸ
DOMAIN,ocsp.apple.com,Reject

# Boxjs ä»£ç†
DOMAIN-KEYWORD,jsdelivr.net,Proxy
DOMAIN-KEYWORD,i.pinimg.com,Proxy
DOMAIN-KEYWORD,64.media.tumblr.com,Proxy

# Sub-Store çš„ Web é¡µé¢
DOMAIN-SUFFIX,vercel.app,Proxy

# åç»­è§„åˆ™ä¿®æ­£
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Direct/Direct.list,Direct

# å¹¿å‘Šæ‹¦æˆª
RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Guard/Advertising.list,Reject
RULE-SET,https://raw.githubusercontent.com/Cats-Team/AdRules/main/adrules.list,Reject
DOMAIN-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Guard/AdvertisingPlus.list,Reject

# éšç§ä¿æŠ¤
RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Guard/Privacy.list,Reject

# è¿è¥å•†åŠ«æŒæˆ–æ¶æ„ç½‘ç«™
RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Guard/Hijacking.list,Reject

# è…¾è®¯ WeChat ASN
IP-ASN,132203,Direct
IP-ASN,56040,Direct
IP-ASN,45090,Direct

# è…¾è®¯ WeChat
RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Extra/WeChat.list,Direct
RULE-SET,https://raw.githubusercontent.com/NobyDa/Script/master/Surge/WeChat.list,Direct

# æŠ–éŸ³è§†é¢‘
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/DouYin/DouYin.list,Direct

# Apple æœåŠ¡
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Apple/Apple.list,Apple
RULE-SET,https://raw.githubusercontent.com/TributePaulWalker/Profiles/main/Surge/Ruleset/ApplePushNotificationService.list,Apple

# å…¨çƒåŠ é€Ÿ
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Global/Global_All_No_Resolve.list,Proxy

# ä¸­å›½ç›´è¿
RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/China.list,Direct
RULE-SET,https://raw.githubusercontent.com/VirgilClyne/GetSomeFries/auto-update/ruleset/ASN.China.list,Direct

# Local Area Network å±€åŸŸç½‘
RULE-SET,LAN,Direct

# GeoIP China
GEOIP,CN,Direct

FINAL,Final,dns-failed
# ç™¾åº¦è´´å§å»å¹¿å‘Š
RULE-SET,https://raw.githubusercontent.com/app2smile/rules/master/rule/tieba-ad.list,REJECT-DROP

[URL Rewrite]
# Safari å…¨èƒ½æœç´¢
# ä»¥ä¸‹ä¸º Safari å…¨èƒ½æœç´¢ã€éœ€è¦æŠŠ Safari çš„æœç´¢å¼•æ“è®¾ç½®ä¸º: DuckDuckGo
# gm (Googleå›¾ç‰‡)
^https:\/\/duckduckgo.com\/\?q=gm\+([^&]+).+ https://www.google.com/search?&tbm=isch&q=$1 302
# gh (GitHub)
^https:\/\/duckduckgo.com\/\?q=gh\+([^&]+).+ https://github.com/search?q=$1 302
# wx (å¾®ä¿¡)
^https:\/\/duckduckgo.com\/\?q=wx\+([^&]+).+ https://weixin.sogou.com/weixinwap?query=$1 302
# jd (äº¬ä¸œ)
^https:\/\/duckduckgo.com\/\?q=jd\+([^&]+).+ https://so.m.jd.com/ware/search.action?keyword=$1 302
# tb (æ·˜å®)
^https:\/\/duckduckgo.com\/\?q=tb\+([^&]+).+ https://s.m.taobao.com/h5?q=$1 302
# tm (å¤©çŒ«)
^https:\/\/duckduckgo.com\/\?q=tm\+([^&]+).+ https://s.m.tmall.com/m/search.htm?q=$1 302
# ytb (YouTube)
^https:\/\/duckduckgo.com\/\?q=ytb\+([^&]+).+ https://www.youtube.com/results?search_query=$1 302
# ph (PornHub)
^https:\/\/duckduckgo.com\/\?q=ph\+([^&]+).+ https://cn.pornhub.com/video/search?search=$1 302
# db (è±†ç“£ï¼‰
^https:\/\/duckduckgo.com\/\?q=db\+([^&]+).+ https://m.douban.com/search/?query=$1 302
# bi (å¿…åº”)
^https:\/\/duckduckgo.com\/\?q=bi\+([^&]+).+ https://cn.bing.com/search?q=$1 302
# bd (ç™¾åº¦)
^https:\/\/duckduckgo.com\/\?q=bd\+([^&]+).+ https://www.baidu.com/s?wd=$1 302
# ddg (DuckDuckGo)
^https:\/\/duckduckgo.com\/\?q=ddg\+([^&]+).+ https://duckduckgo.com/?ia=about&q=$1 302
# æ— æŒ‡ä»¤ (Google)
^https:\/\/duckduckgo.com\/\?q=([^&]+).+ https://www.google.com/search?q=$1 302
# é˜»æ­¢ google.com è·³è½¬åˆ° google.com.hk
^https?:\/\/(www\.)?g\.cn https://www.google.com/ncr 302
^https?:\/\/(www\.)?google\.cn https://www.google.com/ncr 302

[Map Local]
^https?:\/\/[\w-]+\.googlevideo\.com\/initplayback.+&oad data="https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/dist/blank.txt" header="Content-Type: application/vnd.yt-ump"

[Script]
Sub-Store Core=type=http-request,pattern=^https?:\/\/sub\.store\/((download)|api\/(preview|sync|(utils\/node-info))),script-path=https://github.com/sub-store-org/Sub-Store/releases/latest/download/sub-store-1.min.js,requires-body=true,timeout=120,ability=http-client-policy

Sub-Store Simple=type=http-request,pattern=^https?:\/\/sub\.store,script-path=https://github.com/sub-store-org/Sub-Store/releases/latest/download/sub-store-0.min.js,requires-body=true

Rewrite: BoxJs = type=http-request,pattern=^https?:\/\/(.+\.)?boxjs\.(com|net),script-path=https://raw.githubusercontent.com/chavyleung/scripts/master/box/chavy.boxjs.js, requires-body=true, timeout=120

è±†ç“£å½±è§† = type=http-response,pattern=^https://m.douban.com/movie/subject/.+,requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/githubdulong/Script/master/Douban.js

äº¬ä¸œæ¯”ä»· = type=http-response,requires-body=1,pattern=^https?:\/\/api\.m\.jd\.com\/client\.action\?functionId=(wareBusiness|serverConfig|basicConfig),script-path=https://raw.githubusercontent.com/deezertidal/private/main/jdprice.js

Bç«™å‡€åŒ– = type=http-response,pattern=^https:\/\/app\.bilibili\.com\/x\/(v2\/(splash\/(list|show)|feed\/index\?)|resource\/show\/tab\/v2),requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/bilibili-json.js,script-update-interval=0
bili-proto = type=http-response,pattern=^https:\/\/(grpc\.biliapi\.net|app\.bilibili\.com)\/bilibili\.app\.(view\.v1\.View\/View|dynamic\.v2\.Dynamic\/DynAll)$,requires-body=1,binary-body-mode=1,max-size=0,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/bilibili-proto.js,script-update-interval=0

è´´å§å‡€åŒ– = type=http-response,pattern=^http(s:\/\/tiebac|:\/\/c\.tieba)\.baidu\.com\/(tiebaads\/commonbatch|c\/s\/sync),requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/tieba-json.js,script-update-interval=0
è´´å§Proto = type=http-response,pattern=^http(s:\/\/tiebac|:\/\/c\.tieba)\.baidu\.com\/c\/f\/(frs\/(page|threadlist|generalTabList)|pb\/page|excellent\/personalized),requires-body=1,binary-body-mode=1,max-size=0,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/tieba-proto.js,script-update-interval=0

youtube.request = type=http-request,pattern=^https:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(browse|next|player|reel\/reel_watch_sequence)\?,requires-body=1,max-size=-1,binary-body-mode=1,script-path=https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/dist/youtube.request.beta.js
youtube.response = type=http-response,pattern=^https:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(browse|next|player|search|reel\/reel_watch_sequence|guide|account\/get_setting)\?,requires-body=1,max-size=-1,binary-body-mode=1,script-path=https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/dist/youtube.response.beta.js

YJ = type=generic,timeout=5,script-path=https://raw.githubusercontent.com/getsomecat/GetSomeCats/Surge/script/youjia.js,argument=hebei/langfang

èŠ‚å‡æé†’ = type=generic,timeout=10,script-path=https://raw.githubusercontent.com/TributePaulWalker/Profiles/main/JavaScript/Surge/Timecard.js

ç½‘ç»œä¿¡æ¯ = type=generic,timeout=10,script-path=https://raw.githubusercontent.com/TributePaulWalker/Profiles/main/JavaScript/Surge/ipcheck.js

ä»Šæ—¥é»„å†æ’­æŠ¥ = type=cron,timeout=30,cronexp=30 7 * * *,wake-system=1,script-path=https://raw.githubusercontent.com/TributePaulWalker/Profiles/main/JavaScript/Surge/wnCalendar.js

è§£é™¤å¾®ä¿¡é“¾æ¥é™åˆ¶ = type=http-response,pattern=^https\:\/\/(weixin110\.qq|security.wechat)\.com\/cgi-bin\/mmspamsupport-bin\/newredirectconfirmcgi\?,requires-body=1,max-size=0,script-path=https://raw.githubusercontent.com/zZPiglet/Task/master/asset/UnblockURLinWeChat.js

[MITM]
# è·³è¿‡æœåŠ¡ç«¯è¯ä¹¦éªŒè¯
skip-server-cert-verify = true

# MITM over HTTP/2
h2 = true

# ä¸»æœºå
hostname = sub.store, boxjs.com, boxjs.net, *.boxjs.com, *.boxjs.net, api.m.jd.com, m.douban.com, duckduckgo.com, app.bilibili.com, grpc.biliapi.net, tiebac.baidu.com, www.google.cn, www.g.cn, *.googlevideo.com, youtubei.googleapis.com, security.wechat.com, weixin110.qq.com